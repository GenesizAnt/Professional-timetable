<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Запись клиента</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
            crossorigin="anonymous"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/67a92a6cb5.js" crossorigin="anonymous"></script>
    <link rel="shortcut icon" href="/t.ico" type="image/x-icon">
    <link rel="stylesheet" href="/css/fontello.css">
    <link rel="stylesheet" href="/css/style.css">


    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="text/javascript" charset="utf8"
            src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.css">

    <style>
        /*.custom-table table {*/
        /*    width: 100%;*/
        /*}*/
        .custom-table table,
        .custom-tableAp table {
            width: 100%;
            /*table-layout: fixed; !* Фиксированная компоновка *!*/
        }

        .custom-table table, .custom-tableAp table {
            /*table-layout: fixed;*/
        }

        /*.custom-table td {*/
        /*    word-wrap: break-word;*/
        /*}*/
        .custom-table td, .custom-tableAp td {
            word-wrap: break-word;
        }

        .col-dayOfWeekAp {
            width: 9%;
            text-align: center;
            vertical-align: middle;
        }

        .col-dateAp {
            width: 30%;
            text-align: center;
            vertical-align: middle;
        }

        .col-timeAp {
            width: 10%;
            text-align: center;
            vertical-align: middle;
        }

        .col-clientAp {
            width: 35%;
            text-align: center;
            vertical-align: middle;
        }

        .col-specAp {
            width: 16%;
            text-align: center;
            vertical-align: middle;
        }

        .col-dayOfWeek {
            width: 10%;
        }

        .col-date {
            width: 33%;
        }

        .col-time {
            width: 17%;
        }

        .col-client {
            width: 40%;
            text-align: center;
            vertical-align: middle;
        }


    </style>

</head>
<body>
<ul class="nav nav-pills justify-content-center">
    <li class="nav-item">
        <a class="nav-link active" aria-current="page" th:href="@{/specialist/start_menu_specialist}">Меню
            специалиста</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" th:href="@{/enroll/enroll_page}">Запись клиента</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" th:href="@{/calendar/admission_calendar_view}">Управление календарем</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" th:href="@{/administration/proof_clients}">Управление оплатами</a>
    </li>
    <li class="nav-item">
        <form th:method="POST" th:action="@{/logout}">
            <input type="submit" class="btn btn-secondary" value="Выход">
        </form>
    </li>
</ul>

<header>
    <div class="container">
        <div class="row text-center text-white">
            <div class="col-12">
                <h1 class="text-center text-white" th:text="${name} + ', здесь ты можешь управлять записями клиентов'">
                    Привет, специалист</h1>
            </div>
        </div>
    </div>
</header>

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <symbol id="check-circle-fill" fill="currentColor" viewBox="0 0 16 16">
        <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
    </symbol>
    <symbol id="info-fill" fill="currentColor" viewBox="0 0 16 16">
        <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
    </symbol>
    <symbol id="exclamation-triangle-fill" fill="currentColor" viewBox="0 0 16 16">
        <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
    </symbol>
</svg>

<section class="chooseclient">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <h3 class="text-center color1 mb-5">Выбери клиента, а затем запиши или отмени прием</h3>
                <div id="error-container"></div>
                <!--                <div class="alert alert-danger text-center" role="alert" th:if="${param.error != null}">-->
<!--                    <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Danger:">-->
<!--                        <use xlink:href="#exclamation-triangle-fill"/>-->
<!--                    </svg>-->
<!--                    <span style="color:firebrick" th:text="${param.error}"></span>-->
<!--                </div>-->
            </div>
            <div class="row">
                <div class="col-md-6 col-sm-12 text-center">
                    <div class="itd_circle"><i class="fa-solid fa-person"></i></div>
                    <button type="button" class="btn btn-primary btn-list" data-bs-toggle="modal"
                            data-bs-target="#listAssigned">
                        <h6 class="text-center">Выбери закрепленного клиента для записи</h6>
                    </button>
                    <div class="modal fade" id="listAssigned" tabindex="-1" aria-labelledby="listAssignedLabel"
                         aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header bg-success text-white">
                                    <h5 class="modal-title" id="listAssignedLabel">Список закрепленных за специалистом
                                        клиентов</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form th:method="POST" th:action="@{/enroll/customerForRecording}">
                                        <input type="hidden" th:name="registeredStatus" th:value="REGISTERED"/>
                                        <select class="form-select" aria-label="Select Client" name="clientFullName"
                                                required>
                                            <option value="">Выбери клиента для записи</option>
                                            <option th:each="client : ${clientsBySpecialist}"
                                                    th:value="${client.id}"
                                                    th:text="${client.username + ' ' + client.surname + ' ' + client.patronymic}">
                                            </option>
                                        </select>
                                        <button type="submit" class="btn btn-info btn-enroll" tabindex="-1"
                                                role="button">Выбрать
                                        </button>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="line"></div>
                </div>
                <div class="col-md-6 col-sm-12 text-center">
                    <div class="itd_circle"><i class="fa-solid fa-person-circle-question"></i></div>
                    <button type="button" class="btn btn-primary btn-list" data-bs-toggle="modal"
                            data-bs-target="#listUnregistered">
                        <h6 class="text-center">Выбери не зарегистрированного клиента для записи</h6>
                    </button>
                    <div class="modal fade" id="listUnregistered" tabindex="-1" aria-labelledby="listUnregisteredLabel"
                         aria-hidden="true">
                        <div class="modal-dialog modal-dialog-scrollable modal-lg">
                            <div class="modal-content">
                                <div class="modal-header bg-success text-white">
                                    <h5 class="modal-title" id="listUnregisteredLabel">Список НЕ ЗАРЕГИСТРИРОВАННЫХ
                                        клиентов</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form th:method="POST" th:action="@{/enroll/customerForRecording}">
                                        <input type="hidden" th:name="registeredStatus" th:value="UNREGISTERED"/>
                                        <select class="form-select" size="10" aria-label="Select Client"
                                                name="clientFullName" required>
                                            <option value="">Выбери клиента для записи</option>
                                            <option th:each="client : ${unregisteredBySpecialist}"
                                                    th:value="${client.id}"
                                                    th:text="${client.usernameUnregistered + ' ' + client.surnameUnregistered + ' ' + client.patronymicUnregistered}">
                                            </option>
                                        </select>
                                        <button type="submit" class="btn btn-info btn-enroll btn-sm" tabindex="-1"
                                                role="button">Выбрать
                                        </button>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="line"></div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="forwhom">
    <div class="container">
        <div class="row mb-5">
            <h5 class="text-center">
                <span  th:text="${selectedCustomerFullName != null} ? 'Записываем: ' + ${selectedCustomerFullName} : 'Клиент для записи еще не выбран!'"
                    class="custom-text">
                    Клиент для записи еще не выбран!
                </span>
            </h5>
        </div>
    </div>
</section>


<section class="managementlient">
    <div class="container">
        <div class="row">
<!--            <div class="col-xl-4 col-md-6 col-sm-12 text-center">-->
<!--                <div class="itd_circle"><i class="fa-solid fa-person-circle-check"></i></div>-->
<!--                <button type="button" class="btn btn-primary btn-list" data-bs-toggle="modal"-->
<!--                        data-bs-target="#appointment">-->
<!--                    <h6 class="text-center">Запись</h6>-->
<!--                </button>-->
<!--                <div class="modal fade" id="appointment" tabindex="-1" aria-labelledby="appointmentLabel"-->
<!--                     aria-hidden="true">-->
<!--                    <div class="modal-dialog">-->
<!--                        <div class="modal-content">-->
<!--                            <div class="modal-header bg-success text-white">-->
<!--                                <h5 class="modal-title" id="appointmentLabel">Выберите дату и время для записи</h5>-->
<!--                                <button type="button" class="btn-close" data-bs-dismiss="modal"-->
<!--                                        aria-label="Close"></button>-->
<!--                            </div>-->
<!--                            <div class="modal-body">-->
<!--                                <form th:method="POST" th:action="@{/enroll/newDatesAppointments}">-->
<!--                                    <input type="hidden" th:name="selectedCustomerId" th:value="${selectedCustomerId}"/>-->
<!--                                    <input type="hidden" th:name="registeredStatus" th:value="${registeredStatus}"/>-->
<!--                                    <div class="col-12">-->
<!--                                        <input type="datetime-local" id="meeting" name="meeting">-->
<!--                                    </div>-->
<!--                                    <button type="submit" class="btn btn-info btn-enroll btn-sm" tabindex="-1"-->
<!--                                            role="button">Записать-->
<!--                                    </button>-->
<!--                                </form>-->
<!--                            </div>-->
<!--                            <div class="modal-footer">-->
<!--                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
<!--                <div class="line"></div>-->
<!--            </div>-->
<!--            <div class="col-xl-4 col-md-6 col-sm-12 text-center">-->
<!--                <div class="itd_circle"><i class="fa-solid fa-person-circle-xmark"></i></div>-->
<!--                <button type="button" class="btn btn-primary btn-list" data-bs-toggle="modal"-->
<!--                        data-bs-target="#appointmentClose">-->
<!--                    <h6 class="text-center">Отменить запись</h6>-->
<!--                </button>-->
<!--                <div class="modal fade" id="appointmentClose" tabindex="-1" aria-labelledby="appointmentCloseLabel"-->
<!--                     aria-hidden="true">-->
<!--                    <div class="modal-dialog">-->
<!--                        <div class="modal-content">-->
<!--                            <div class="modal-header bg-success text-white">-->
<!--                                <h5 class="modal-title" id="appointmentCloseLabel">Выберите дату и время для отмены-->
<!--                                    записи</h5>-->
<!--                                <button type="button" class="btn-close" data-bs-dismiss="modal"-->
<!--                                        aria-label="Close"></button>-->
<!--                            </div>-->
<!--                            <div class="modal-body">-->
<!--                                <form th:method="POST" th:action="@{/enroll/cancellingBooking}">-->
<!--                                    <div class="col-12">-->
<!--                                        <input type="datetime-local" id="meetingCancel" name="meetingCancel">-->
<!--                                    </div>-->
<!--                                    <button type="submit" class="btn btn-info btn-enroll btn-sm" tabindex="-1"-->
<!--                                            role="button">Отменить запись-->
<!--                                    </button>-->
<!--                                </form>-->
<!--                            </div>-->
<!--                            <div class="modal-footer">-->
<!--                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
<!--                <div class="line"></div>-->
<!--            </div>-->
            <div class="col-xl-4 col-md-6 col-sm-12 text-center">
                <div class="itd_circle"><i class="fa-solid fa-person-circle-exclamation"></i></div>
                <button type="button" class="btn btn-primary btn-list" data-bs-toggle="modal"
                        data-bs-target="#addUnregisteredPerson">
                    <h6 class="text-center">Добавить НЕ ЗАРЕГИСТРИРОВАННОГО клиента</h6>
                </button>
                <div class="modal fade" id="addUnregisteredPerson" tabindex="-1"
                     aria-labelledby="addUnregisteredPersonLabel"
                     aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header bg-success text-white">
                                <h5 class="modal-title" id="addUnregisteredPersonLabel">Внесите данные клиента</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form th:method="POST" th:action="@{/enroll/newUnregisteredPerson}">
                                    <div class="input-group">
                                        <span class="input-group-text text-center">Имя</span>
                                        <input type="text" aria-label="usernameUnregistered" name="usernameUnregistered"
                                               class="form-control">
                                    </div>
                                    <div class="input-group">
                                        <span class="input-group-text text-center">Фамилия</span>
                                        <input type="text" aria-label="surnameUnregistered" name="surnameUnregistered"
                                               class="form-control">
                                    </div>
                                    <div class="input-group">
                                        <span class="input-group-text text-center">Отчество</span>
                                        <input type="text" aria-label="patronymicUnregistered"
                                               name="patronymicUnregistered" class="form-control">
                                    </div>
                                    <button type="submit" class="btn btn-info btn-enroll btn-sm" tabindex="-1"
                                            role="button">Добавить
                                    </button>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="line"></div>
            </div>
        </div>
    </div>

    <h5 class="text-center color1 mb-5">Таблица приемов</h5>
    <div class="container">
        <div class="table-responsive-sm custom-table">
            <table class="table table-secondary table-bordered table-striped">
                <thead>
                <tr>
                    <th scope="col"></th>
                    <th scope="col">Дата</th>
                    <th scope="col">Время</th>
                    <th scope="col">Клиент</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="vacantSeat : ${vacantSeats}">
                    <td hidden th:text="${vacantSeat.id}"></td>
                    <td class="col-dayOfWeek" th:text="${vacantSeat.dayOfWeek}"></td>
                    <td class="col-date" th:text="${vacantSeat.dateVacant}"></td>
                    <td class="col-time" th:text="${vacantSeat.timeVacant}"></td>
                    <td class="col-client">
                        <span th:if="${vacantSeat.idVisitor != null}">
                            <span th:text="${vacantSeat.fullname}"></span>
                            <a href="javascript:void(0)" class="cancel-client">(отменить)</a>
<!--                            <a href="javascript:void(0)" class="cancel-client" th:href="@{'/enroll/cancel/' + ${vacantSeat.id}}">(отменить)</a>-->
                        </span>
                        <a th:if="${vacantSeat.idVisitor == null}" href="javascript:void(0)" class="record-client">Записать</a>
                    </td>
                </tr>
                </tbody>
            </table>
            <nav aria-label="Page navigation" class="pagination-container">
                <ul class="pagination justify-content-center">
                    <!-- Если данных нет, показываем только одну страницу -->
                    <li th:if="${page.totalPages == 0}" class="page-item active">
                        <a class="page-link">1</a>
                    </li>

                    <!-- Если данные есть -->
                    <li th:if="${page.totalPages > 0}" class="page-item" th:classappend="${page.first} ? 'disabled'">
                        <a class="page-link" th:href="@{/enroll(page=${page.number - 1}, size=${param.size})}" aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>

                    <!-- Генерация номеров страниц -->
                    <li th:if="${page.totalPages > 0}" class="page-item" th:each="i : ${#numbers.sequence(0, page.totalPages - 1)}"
                        th:classappend="${page.number == i} ? 'active'">
                        <a class="page-link" th:href="@{/enroll/vacantSeats(page=${i}, size=${param.size})}" th:text="${i + 1}"></a>
                    </li>

                    <!-- Кнопка перехода на следующую страницу -->
                    <li th:if="${page.totalPages > 0}" class="page-item" th:classappend="${page.last} ? 'disabled'">
                        <a class="page-link" th:href="@{/enroll/vacantSeats(page=${page.number + 1}, size=${param.size})}"
                           aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</section>

<h5 class="text-center color1 mb-5">Таблица подтверждения записей</h5>
<div class="container">
    <div class="table-responsive-sm custom-tableAp">
        <table class="table table-secondary table-bordered table-striped">
            <thead>
            <tr>
                <th scope="col"></th>
                <th scope="col" style="text-align: center;">Дата</th>
                <th scope="col" style="text-align: center;">Время</th>
                <th scope="col" style="text-align: center;">Клиент</th>
                <th scope="col" style="text-align: center;">Спец</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="reception : ${aproveReceptions}">
                <td hidden th:text="${reception.id}"></td>
                <td class="col-dayOfWeekAp" th:text="${reception.dayOfWeek}"></td>
                <td class="col-dateAp" th:text="${reception.dateVacant}"></td>
                <td class="col-timeAp" th:text="${reception.timeVacant}"></td>
                <td class="col-clientAp">
                    <span th:if="${reception.visitorIdReception != null}" style="display: flex; flex-direction: column; align-items: center;">
                        <span th:text="${reception.visitorIdReception.getFullName()}" style="text-align: center;"><br>
                            <span th:text="'Подтверждено'"
                                  style="color: #1196de; text-align: center;">
                            </span>
                        </span>
                        <span th:if="${reception.confirmedVisitor == true}"
                              th:text="'Подтверждено'"
                              style="color: #1196de; text-align: center; margin-top: 5px;">
                        </span>
                        <span th:if="${reception.confirmedVisitor == false}" style="color: #ea7777; text-align: center; margin-top: 5px;">
                              <a href="javascript:void(0)" class="agree-visitor">Не подтверждено</a>
                        </span>
                    </span>
                </td>
                <td class="col-specAp">
                    <span th:if="${reception.confirmedSpecialist == true}"
                          th:text="'Подт-но'"
                          style="color: #1196de; text-align: center;">
                        </span>
                    <span th:if="${reception.confirmedSpecialist == false}" style="color: #ea7777; text-align: center;">
<!--                            <span th:text="'Не подт-но'"></span>-->
                            <a href="javascript:void(0)" class="agree-spec">Не подт-но</a>
                    </span>
                </td>
            </tr>
            </tbody>
        </table>
        <nav aria-label="Page navigation" class="pagination-container">
            <ul class="pagination justify-content-center">
                <!-- Условие для проверки: если данных нет -->
                <li th:if="${pageAp.totalPages == 0}" class="page-item active">
                    <a class="page-link">1</a>
                </li>

                <!-- Если данные есть -->
                <li th:if="${pageAp.totalPages > 0}" class="page-item" th:classappend="${pageAp.first} ? 'disabled'">
                    <a class="page-link" th:href="@{/enroll(pageAp=${pageAp.number - 1}, size=${param.size})}"
                       aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>

                <!-- Генерация номеров страниц -->
                <li th:if="${pageAp.totalPages > 0}" class="page-item" th:each="i : ${#numbers.sequence(0, pageAp.totalPages - 1)}"
                    th:classappend="${pageAp.number == i} ? 'active'">
                    <a class="page-link" th:href="@{/enroll/aproveReceptions(pageAp=${i}, size=${param.size})}"
                       th:text="${i + 1}"></a>
                </li>

                <li th:if="${pageAp.totalPages > 0}" class="page-item" th:classappend="${pageAp.last} ? 'disabled'">
                    <a class="page-link"
                       th:href="@{/enroll/aproveReceptions(page=${pageAp.number + 1}, size=${param.size})}"
                       aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>
</div>
</section>

<script th:inline="javascript">
    let csrfToken = document.querySelector('input[name="_csrf"]').value;
    let selectedCustomerId1 = /*[[${selectedCustomerId}]]*/ '';
    let registeredStatus1 = /*[[${registeredStatus}]]*/ '';

    $(document).ready(function () {
        // При нажатии на запись
        $('.record-client').click(function () {
            var row = $(this).closest('tr');
            var id = row.find('td:eq(0)').text(); // Получаем значение ID выбранной записи


            // Отправляем данные на контроллер для обработки
            var applicationFromSpecialist = {
                // specialistId: idSpecialist,
                id: id,
                selectedCustomerId: selectedCustomerId1,
                registeredStatus: registeredStatus1
            }; // Ваши данные для отправки на контроллер
            // Здесь вы можете заполнить объект applicationFromVisitor необходимыми данными
            // Отправляем данные на сервер
            fetch("/enroll/record-client", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-Token': csrfToken // Добавляем CSRF токен в заголовок запроса
                    // Здесь могут быть другие заголовки, если необходимо
                },
                body: JSON.stringify(applicationFromSpecialist)
            }).then(response => {

                if (response.ok) {
                    // Если ответ успешный, браузер автоматически выполнит редирект
                    location.reload();
                } else {
                    return response.json().then(errorData => {
                        displayError(errorData.error); // Вызов функции для отображения ошибки
                    });
                    // return response.json().then(error => {
                    //     throw new Error(error.error);
                    // });
                }
            }).catch(error => {
                    // Обрабатываем ошибки при отправке запроса на сервер
                alert(error.message);
            });
        });
    });

    // Функция для отображения ошибки
    function displayError(errorMessage) {
        // Находим блок, в который будем вставлять ошибку
        const errorContainer = document.getElementById('error-container');
        errorContainer.innerHTML = `
        <div class="alert alert-danger text-center" role="alert">
            <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Danger:">
                <use xlink:href="#exclamation-triangle-fill"/>
            </svg>
            <span style="color:firebrick">${errorMessage}</span>
        </div>
    `;
    }



    $(document).ready(function () {
        // При нажатии на запись
        $('.cancel-client').click(function () {
            var row = $(this).closest('tr');
            var id = row.find('td:eq(0)').text(); // Получаем значение ID выбранной записи


            // Отправляем данные на контроллер для обработки
            var applicationFromSpecialist = {
                // specialistId: idSpecialist,
                id: id,
            }; // Ваши данные для отправки на контроллер
            // Здесь вы можете заполнить объект applicationFromVisitor необходимыми данными
            // Отправляем данные на сервер
            fetch("/enroll/cancel", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-Token': csrfToken // Добавляем CSRF токен в заголовок запроса
                    // Здесь могут быть другие заголовки, если необходимо
                },
                body: JSON.stringify(applicationFromSpecialist)
            }).then(response => {
                location.reload();
                // Обрабатываем ответ от сервера
            })
                .catch(error => {
                    // Обрабатываем ошибки при отправке запроса на сервер
                });
        });
    });

    $(document).ready(function () {
        // При нажатии на запись
        $('.agree-spec').click(function () {
            var row = $(this).closest('tr');
            var id = row.find('td:eq(0)').text(); // Получаем значение ID выбранной записи


            // Отправляем данные на контроллер для обработки
            var applicationFromSpecialist = {
                // specialistId: idSpecialist,
                id: id,
            }; // Ваши данные для отправки на контроллер
            // Здесь вы можете заполнить объект applicationFromVisitor необходимыми данными
            // Отправляем данные на сервер
            fetch("/enroll/agree-spec", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-Token': csrfToken // Добавляем CSRF токен в заголовок запроса
                    // Здесь могут быть другие заголовки, если необходимо
                },
                body: JSON.stringify(applicationFromSpecialist)
            }).then(response => {
                location.reload();
                // Обрабатываем ответ от сервера
            })
                .catch(error => {
                    // Обрабатываем ошибки при отправке запроса на сервер
                });
        });
    });

    $(document).ready(function () {
        // При нажатии на запись
        $('.agree-visitor').click(function () {
            var row = $(this).closest('tr');
            var id = row.find('td:eq(0)').text(); // Получаем значение ID выбранной записи


            // Отправляем данные на контроллер для обработки
            var applicationFromSpecialist = {
                // specialistId: idSpecialist,
                id: id,
            }; // Ваши данные для отправки на контроллер
            // Здесь вы можете заполнить объект applicationFromVisitor необходимыми данными
            // Отправляем данные на сервер
            fetch("/enroll/agree-visitor", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-Token': csrfToken // Добавляем CSRF токен в заголовок запроса
                    // Здесь могут быть другие заголовки, если необходимо
                },
                body: JSON.stringify(applicationFromSpecialist)
            }).then(response => {
                location.reload();
                // Обрабатываем ответ от сервера
            })
                .catch(error => {
                    // Обрабатываем ошибки при отправке запроса на сервер
                });
        });
    });
</script>

<!--<script th:inline="javascript">-->
<!--    $(document).ready(function(){-->
<!--        // При нажатии на запись-->
<!--        $('tr').click(function(){-->
<!--            var id = $(this).find('th:eq(0)').text(); // Получаем значение ID выбранной записи-->
<!--            var date = $(this).find('td:eq(0)').text(); // Получаем значение даты выбранной записи-->
<!--            var time = $(this).find('td:eq(1)').text(); // Получаем значение времени выбранной записи-->
<!--            var client = $(this).find('td:eq(2)').text(); // Получаем значение клиента выбранной записи-->

<!--            var confirmDelete = confirm("Точно хотите удалить запись?");-->

<!--            // Отправляем данные на контроллер для обработки-->
<!--            var applicationFromSpecialist = {-->
<!--                // specialistId: idSpecialist,-->
<!--                id: id,-->
<!--                date: date,-->
<!--                time: time,-->
<!--                client: client-->
<!--            }; // Ваши данные для отправки на контроллер-->
<!--            // Здесь вы можете заполнить объект applicationFromVisitor необходимыми данными-->
<!--            // Отправляем данные на сервер-->
<!--            fetch("/calendar/your-controller-url", {-->
<!--                method: 'POST',-->
<!--                headers: {-->
<!--                    'Content-Type': 'application/json',-->
<!--                    'X-CSRF-Token': csrfToken // Добавляем CSRF токен в заголовок запроса-->
<!--                    // Здесь могут быть другие заголовки, если необходимо-->
<!--                },-->
<!--                body: JSON.stringify(applicationFromSpecialist)-->
<!--            })-->
<!--        });-->
<!--    });-->
<!--</script>-->

<!--<script th:inline="javascript">-->

<!--    var csrfToken = document.querySelector('input[name="_csrf"]').value;-->
<!--    // var idSpecialist = JSON.parse(/*[[${idSpecialist}]]*/ '');-->
<!--    var selectedCustomerId1 = /*[[${selectedCustomerId}]]*/ '';-->
<!--    var registeredStatus1 = /*[[${registeredStatus}]]*/ '';-->


<!--    function createTable(data) {-->
<!--        var table = document.createElement('table');-->
<!--        table.className = "table";-->
<!--        var tableBody = document.createElement('tbody');-->

<!--        // Создаем строку заголовков-->
<!--        var tr = document.createElement('tr');-->

<!--        var th1 = document.createElement('th');-->
<!--        th1.textContent = data[0][0];-->
<!--        th1.colSpan = 1;-->
<!--        tr.appendChild(th1);-->

<!--        var th2 = document.createElement('th');-->
<!--        th2.textContent = data[0][1];-->
<!--        th2.colSpan = 2;-->
<!--        tr.appendChild(th2);-->

<!--        tableBody.appendChild(tr);-->

<!--        var tr = document.createElement('tr');-->
<!--        data[1].forEach(elem => {-->
<!--            let th = document.createElement('th');-->
<!--            th.textContent = elem;-->
<!--            tr.appendChild(th);-->
<!--        });-->
<!--        tableBody.appendChild(tr);-->

<!--        for (var i = 2; i < data.length; i++) {-->
<!--            tr = document.createElement('tr');-->
<!--            data[i].forEach((elem, index) => {-->
<!--                var ind = i;-->
<!--                var td = document.createElement('td');-->
<!--                // Проверяем, является ли текущий столбец третьим (индекс 2) и содержит ли ячейка текст "Доступно"-->
<!--                if (index === 2 && elem === "Доступно") {-->
<!--                    var link = document.createElement('a');-->
<!--                    link.textContent = elem;-->
<!--                    link.href = "#"; // Установите ссылку на текущую страницу или другую подходящую для вашего случая-->
<!--                    link.addEventListener('click', function (event) {-->
<!--                        event.preventDefault(); // Предотвращаем переход по ссылке по умолчанию-->

<!--                        var applicationFromSpecialist = {-->
<!--                            // specialistId: idSpecialist,-->
<!--                            meetingDate: table.rows[0].cells[0].textContent,-->
<!--                            meetingTime: table.rows[ind].cells[index - 2].textContent,-->
<!--                            selectedCustomerId: selectedCustomerId1,-->
<!--                            registeredStatus: registeredStatus1-->
<!--                        }; // Ваши данные для отправки на контроллер-->
<!--                        // Здесь вы можете заполнить объект applicationFromVisitor необходимыми данными-->

<!--                        // Отправляем данные на сервер-->
<!--                        fetch("/enroll/newDatesAppointmentsTable", {-->
<!--                            method: 'POST',-->
<!--                            headers: {-->
<!--                                'Content-Type': 'application/json',-->
<!--                                'X-CSRF-Token': csrfToken // Добавляем CSRF токен в заголовок запроса-->
<!--                                // Здесь могут быть другие заголовки, если необходимо-->
<!--                            },-->
<!--                            body: JSON.stringify(applicationFromSpecialist)-->
<!--                        })-->
<!--                            .then(response => {-->
<!--                                location.reload();-->
<!--                                // Обрабатываем ответ от сервера-->
<!--                            })-->
<!--                            .catch(error => {-->
<!--                                // Обрабатываем ошибки при отправке запроса на сервер-->
<!--                            });-->
<!--                    });-->
<!--                    td.appendChild(link);-->
<!--                } else if (index === 2 && elem === "Требует подтверждения") {-->
<!--                    var link = document.createElement('a');-->
<!--                    link.textContent = elem;-->
<!--                    link.href = "#"; // Установите ссылку на текущую страницу или другую подходящую для вашего случая-->
<!--                    link.addEventListener('click', function (event) {-->
<!--                        event.preventDefault(); // Предотвращаем переход по ссылке по умолчанию-->

<!--                        var recordingIsConfirmed = {-->
<!--                            // specialistId: idSpecialist,-->
<!--                            meetingDate: table.rows[0].cells[0].textContent,-->
<!--                            meetingTime: table.rows[ind].cells[index - 2].textContent,-->
<!--                            meetingPerson: table.rows[ind].cells[index - 1].textContent,-->
<!--                            // selectedCustomerId: selectedCustomerId1,-->
<!--                            // registeredStatus: registeredStatus1-->
<!--                        }; // Ваши данные для отправки на контроллер-->
<!--                        // Здесь вы можете заполнить объект applicationFromVisitor необходимыми данными-->

<!--                        // Отправляем данные на сервер-->
<!--                        fetch("/enroll/recordingConfirmed", {-->
<!--                            method: 'POST',-->
<!--                            headers: {-->
<!--                                'Content-Type': 'application/json',-->
<!--                                'X-CSRF-Token': csrfToken // Добавляем CSRF токен в заголовок запроса-->
<!--                                // Здесь могут быть другие заголовки, если необходимо-->
<!--                            },-->
<!--                            body: JSON.stringify(recordingIsConfirmed)-->
<!--                        })-->
<!--                            .then(response => {-->
<!--                                location.reload();-->
<!--                                // Обрабатываем ответ от сервера-->
<!--                            })-->
<!--                            .catch(error => {-->
<!--                                // Обрабатываем ошибки при отправке запроса на сервер-->
<!--                            });-->
<!--                    });-->
<!--                    td.appendChild(link);-->
<!--                } else {-->
<!--                    // Если текст не "Доступно" или это не третий столбец, просто добавляем текст-->
<!--                    td.textContent = elem;-->
<!--                }-->
<!--                tr.appendChild(td);-->
<!--            });-->
<!--            tableBody.appendChild(tr);-->
<!--        }-->

<!--        table.appendChild(tableBody);-->
<!--        document.body.appendChild(table);-->
<!--    }-->

<!--    var data0 = JSON.parse(/*[[${day0}]]*/ '');-->
<!--    var data1 = JSON.parse(/*[[${day1}]]*/ '');-->
<!--    var data2 = JSON.parse(/*[[${day2}]]*/ '');-->
<!--    var data3 = JSON.parse(/*[[${day3}]]*/ '');-->
<!--    var data4 = JSON.parse(/*[[${day4}]]*/ '');-->
<!--    var data5 = JSON.parse(/*[[${day5}]]*/ '');-->
<!--    var data6 = JSON.parse(/*[[${day6}]]*/ '');-->
<!--    var data7 = JSON.parse(/*[[${day7}]]*/ '');-->
<!--    var data8 = JSON.parse(/*[[${day8}]]*/ '');-->
<!--    var data9 = JSON.parse(/*[[${day9}]]*/ '');-->
<!--    var data10 = JSON.parse(/*[[${day10}]]*/ '');-->
<!--    var data11 = JSON.parse(/*[[${day11}]]*/ '');-->
<!--    var data12 = JSON.parse(/*[[${day12}]]*/ '');-->
<!--    var data13 = JSON.parse(/*[[${day13}]]*/ '');-->
<!--    var data14 = JSON.parse(/*[[${day14}]]*/ '');-->
<!--    var data15 = JSON.parse(/*[[${day15}]]*/ '');-->
<!--    var data16 = JSON.parse(/*[[${day16}]]*/ '');-->
<!--    var data17 = JSON.parse(/*[[${day17}]]*/ '');-->
<!--    var data18 = JSON.parse(/*[[${day18}]]*/ '');-->
<!--    var data19 = JSON.parse(/*[[${day19}]]*/ '');-->
<!--    var data20 = JSON.parse(/*[[${day20}]]*/ '');-->

<!--    createTable(data0);-->
<!--    createTable(data1);-->
<!--    createTable(data2);-->
<!--    createTable(data3);-->
<!--    createTable(data4);-->
<!--    createTable(data5);-->
<!--    createTable(data6);-->
<!--    createTable(data7);-->
<!--    createTable(data8);-->
<!--    createTable(data9);-->
<!--    createTable(data10);-->
<!--    createTable(data11);-->
<!--    createTable(data12);-->
<!--    createTable(data13);-->
<!--    createTable(data14);-->
<!--    createTable(data15);-->
<!--    createTable(data16);-->
<!--    createTable(data17);-->
<!--    createTable(data18);-->
<!--    createTable(data19);-->
<!--    createTable(data20);-->
<!--</script>-->

<!--Отображение календаря-->
<!--<div class="table-responsive">-->
<!--    <table class="table">-->
<!--        <thead>-->
<!--        <tr>-->
<!--            <th>Дата</th>-->
<!--            <th>Время</th>-->
<!--            <th>Статус</th>-->
<!--        </tr>-->
<!--        </thead>-->
<!--        <tbody>-->
<!--        <tr th:each="dateEntry : ${dates}">-->
<!--            <td th:text="${dateEntry.key}"></td>-->
<!--            <td>-->
<!--                <div th:each="timeEntry : ${dateEntry.value}">-->
<!--                    <span th:text="${timeEntry.key}"></span><br>-->
<!--                </div>-->
<!--            </td>-->
<!--            <td>-->
<!--                <div th:each="statusEntry : ${dateEntry.value}">-->
<!--                    <span th:text="${statusEntry.value}"></span><br>-->
<!--                </div>-->
<!--            </td>-->
<!--        </tr>-->
<!--        </tbody>-->
<!--    </table>-->
<!--</div>-->

<footer id="footer">
    <div class="container">
        <div class="row align-items-end">
            <div class="col-md-12 text-center text-white">
                <ul class="list-unstyled">
                </ul>
            </div>
        </div>
    </div>
</footer>

<!--<script>-->
<!--    $(document).ready(function () {-->
<!--        $('table').DataTable({-->
<!--            paging: true,-->
<!--            pageLength: 5,-->
<!--            language: {-->
<!--                "lengthMenu": "Показать _MENU_ записей",-->
<!--                "search": "Найти:",-->
<!--                "info": "Отображение от _START_ до _END_ из _TOTAL_ элементов",-->
<!--                "paginate": {-->
<!--                    "previous": "Предыдущий",-->
<!--                    "next": "Следующий"-->
<!--                },-->
<!--            },-->
<!--            "lengthMenu": [-->
<!--                [3, 5, 10, -1],-->
<!--                [3, 5, 10, 'Все']-->
<!--            ]-->
<!--        });-->
<!--    });-->
<!--</script>-->

<!--lengthMenu: [-->
<!--[3, 5, 10, -1],-->
<!--[3, 5, 10, 'All']-->
<!--]-->
<!--"language": {-->
<!--"lengthMenu": "Показать _MENU_ записей"-->
<!--},-->
<!--"lengthMenu": [-->
<!--[3, 5, 10, -1],-->
<!--[3, 5, 10, 'All']-->
<!--]-->

</body>
</html>
<!--<script src="./resources/templates/specialist/test.js"></script>-->
<!--<script src="resources/templates/specialist/test.js"></script>-->
<!--dataTable-->
<!--<lable>Сколько показать-->
<!--    <select name="DataTables_Table_0_length" aria-controls="DataTables_Table_0" class>-->
<!--        <option value="3">3</option>-->
<!--        <option value="5">5</option>-->
<!--        <option value="10">10</option>-->
<!--        <option value="20">20</option> </select>-->
<!--</lable>-->